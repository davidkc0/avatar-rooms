{"version":3,"file":"nodeParticleSystemSet.helper.js","sourceRoot":"","sources":["../../../../../dev/core/src/Particles/Node/nodeParticleSystemSet.helper.ts"],"names":[],"mappings":"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","sourcesContent":["import type { Nullable } from \"core/types\";\r\nimport type { Color4 } from \"core/Maths/math.color\";\r\nimport type { Vector3 } from \"core/Maths/math.vector\";\r\nimport type { Texture } from \"core/Materials/Textures/texture\";\r\nimport type { Mesh } from \"core/Meshes/mesh\";\r\nimport type { ColorGradient } from \"core/Misc\";\r\nimport type { ParticleSystem } from \"core/Particles/particleSystem\";\r\nimport type { IParticleSystem } from \"core/Particles/IParticleSystem\";\r\nimport type { BoxParticleEmitter } from \"core/Particles/EmitterTypes/boxParticleEmitter\";\r\nimport type { ConeParticleEmitter } from \"core/Particles/EmitterTypes/coneParticleEmitter\";\r\nimport type { CylinderParticleEmitter } from \"core/Particles/EmitterTypes/cylinderParticleEmitter\";\r\nimport type { MeshParticleEmitter } from \"core/Particles/EmitterTypes/meshParticleEmitter\";\r\nimport type { PointParticleEmitter } from \"core/Particles/EmitterTypes/pointParticleEmitter\";\r\nimport type { SphereParticleEmitter } from \"core/Particles/EmitterTypes/sphereParticleEmitter\";\r\nimport type { NodeParticleConnectionPoint } from \"core/Particles/Node/nodeParticleBlockConnectionPoint\";\r\nimport type { IShapeBlock } from \"core/Particles/Node/Blocks/Emitters/IShapeBlock\";\r\n\r\nimport { Vector2 } from \"core/Maths/math.vector\";\r\nimport { NodeParticleBlockConnectionPointTypes } from \"core/Particles/Node/Enums/nodeParticleBlockConnectionPointTypes\";\r\nimport { NodeParticleSystemSet } from \"./nodeParticleSystemSet\";\r\nimport { NodeParticleContextualSources } from \"./Enums/nodeParticleContextualSources\";\r\nimport { NodeParticleSystemSources } from \"./Enums/nodeParticleSystemSources\";\r\nimport { ParticleConverterBlock } from \"./Blocks/particleConverterBlock\";\r\nimport { ParticleGradientBlock } from \"./Blocks/particleGradientBlock\";\r\nimport { ParticleGradientValueBlock } from \"./Blocks/particleGradientValueBlock\";\r\nimport { ParticleInputBlock } from \"./Blocks/particleInputBlock\";\r\nimport { ParticleMathBlock, ParticleMathBlockOperations } from \"./Blocks/particleMathBlock\";\r\nimport { ParticleRandomBlock, ParticleRandomBlockLocks } from \"./Blocks/particleRandomBlock\";\r\nimport { ParticleTextureSourceBlock } from \"./Blocks/particleSourceTextureBlock\";\r\nimport { SystemBlock } from \"./Blocks/systemBlock\";\r\nimport { CreateParticleBlock } from \"./Blocks/Emitters/createParticleBlock\";\r\nimport { BoxShapeBlock } from \"./Blocks/Emitters/boxShapeBlock\";\r\nimport { ConeShapeBlock } from \"./Blocks/Emitters/coneShapeBlock\";\r\nimport { CylinderShapeBlock } from \"./Blocks/Emitters/cylinderShapeBlock\";\r\nimport { MeshShapeBlock } from \"./Blocks/Emitters/meshShapeBlock\";\r\nimport { PointShapeBlock } from \"./Blocks/Emitters/pointShapeBlock\";\r\nimport { SphereShapeBlock } from \"./Blocks/Emitters/sphereShapeBlock\";\r\nimport { UpdateColorBlock } from \"./Blocks/Update/updateColorBlock\";\r\nimport { UpdateDirectionBlock } from \"./Blocks/Update/updateDirectionBlock\";\r\nimport { UpdatePositionBlock } from \"./Blocks/Update/updatePositionBlock\";\r\n\r\n/**\r\n * Converts a ParticleSystem to a NodeParticleSystemSet.\r\n * @param name The name of the node particle system set.\r\n * @param particleSystemsList The particle systems to convert.\r\n * @returns The converted node particle system set or null if conversion failed.\r\n * #0K3AQ2#3672\r\n * #7J0NXA#4\r\n */\r\nexport async function ConvertToNodeParticleSystemSetAsync(name: string, particleSystemsList: ParticleSystem[]): Promise<Nullable<NodeParticleSystemSet>> {\r\n    if (!particleSystemsList || !particleSystemsList.length) {\r\n        return null;\r\n    }\r\n\r\n    const nodeParticleSystemSet = new NodeParticleSystemSet(name);\r\n    const promises: Promise<void>[] = [];\r\n\r\n    for (const particleSystem of particleSystemsList) {\r\n        promises.push(_ExtractDatafromParticleSystemAsync(nodeParticleSystemSet, particleSystem));\r\n    }\r\n\r\n    await Promise.all(promises);\r\n    return nodeParticleSystemSet;\r\n}\r\n\r\nasync function _ExtractDatafromParticleSystemAsync(newSet: NodeParticleSystemSet, oldSystem: ParticleSystem): Promise<void> {\r\n    // CreateParticle block\r\n    const createParticleBlock = _CreateCreateParticleBlock(oldSystem);\r\n\r\n    // Emitter Shape block\r\n    const shapeBlock = _CreateEmitterShapeBlock(oldSystem);\r\n    createParticleBlock.particle.connectTo(shapeBlock.particle);\r\n\r\n    // Update the particle position\r\n    const positionUpdatedParticle = _CreateUpdateSystem(shapeBlock.output, oldSystem);\r\n\r\n    // Color update\r\n    const colorUpdateBlock = _CreateColorUpdateBlock(oldSystem, createParticleBlock);\r\n    positionUpdatedParticle.connectTo(colorUpdateBlock.particle);\r\n\r\n    // System block\r\n    const newSystem = _CreateSystemBlock(oldSystem);\r\n    colorUpdateBlock.output.connectTo(newSystem.particle);\r\n\r\n    // Register\r\n    newSet.systemBlocks.push(newSystem);\r\n}\r\n\r\nfunction _CreateSystemBlock(oldSystem: IParticleSystem): SystemBlock {\r\n    const newSystem = new SystemBlock(oldSystem.name);\r\n\r\n    // Translation pivot\r\n    _CreateAndConnectInput(\"Translation pivot\", oldSystem.translationPivot, newSystem.translationPivot);\r\n\r\n    newSystem.emitRate = oldSystem.emitRate;\r\n    newSystem.manualEmitCount = oldSystem.manualEmitCount;\r\n\r\n    newSystem.blendMode = oldSystem.blendMode;\r\n    newSystem.capacity = oldSystem.getCapacity();\r\n    newSystem.targetStopDuration = oldSystem.targetStopDuration;\r\n    newSystem.startDelay = oldSystem.startDelay;\r\n    newSystem.targetStopDuration = oldSystem.targetStopDuration;\r\n    newSystem.updateSpeed = oldSystem.updateSpeed;\r\n    newSystem.preWarmCycles = oldSystem.preWarmCycles;\r\n    newSystem.preWarmStepOffset = oldSystem.preWarmStepOffset;\r\n    newSystem.isBillboardBased = oldSystem.isBillboardBased;\r\n    newSystem.isLocal = oldSystem.isLocal;\r\n    newSystem.disposeOnStop = oldSystem.disposeOnStop;\r\n\r\n    // Texture\r\n    const textureBlock = new ParticleTextureSourceBlock(\"Texture\");\r\n    const url = (oldSystem.particleTexture as Texture).url || \"\";\r\n    if (url) {\r\n        textureBlock.url = url;\r\n    } else {\r\n        textureBlock.sourceTexture = oldSystem.particleTexture;\r\n    }\r\n    textureBlock.texture.connectTo(newSystem.texture);\r\n\r\n    return newSystem;\r\n}\r\n\r\nfunction _CreateCreateParticleBlock(oldSystem: ParticleSystem): CreateParticleBlock {\r\n    // Create particle\r\n    const createParticleBlock = new CreateParticleBlock(\"Create Particle\");\r\n\r\n    // Size\r\n    const randomSizeBlock = new ParticleRandomBlock(\"Random size\");\r\n    _CreateAndConnectInput(\"Min size\", oldSystem.minSize, randomSizeBlock.min);\r\n    _CreateAndConnectInput(\"Max size\", oldSystem.maxSize, randomSizeBlock.max);\r\n    randomSizeBlock.output.connectTo(createParticleBlock.size);\r\n\r\n    // Scale\r\n    const randomScaleBlock = new ParticleRandomBlock(\"Random Scale\");\r\n    _CreateAndConnectInput(\"Min Scale\", new Vector2(oldSystem.minScaleX, oldSystem.minScaleY), randomScaleBlock.min);\r\n    _CreateAndConnectInput(\"Max Scale\", new Vector2(oldSystem.maxScaleX, oldSystem.maxScaleY), randomScaleBlock.max);\r\n    randomScaleBlock.output.connectTo(createParticleBlock.scale);\r\n\r\n    // Color is handled when we do the color update block to manage gradients\r\n\r\n    // Dead color\r\n    _CreateAndConnectInput(\"Dead Color\", oldSystem.colorDead, createParticleBlock.colorDead);\r\n\r\n    // Emit power (Speed)\r\n    const randomEmitPowerBlock = new ParticleRandomBlock(\"Random Emit Power\");\r\n    _CreateAndConnectInput(\"Min Emit Power\", oldSystem.minEmitPower, randomEmitPowerBlock.min);\r\n    _CreateAndConnectInput(\"Max Emit Power\", oldSystem.maxEmitPower, randomEmitPowerBlock.max);\r\n    randomEmitPowerBlock.output.connectTo(createParticleBlock.emitPower);\r\n\r\n    // Angular speed\r\n    const randomAngularSpeedBlock = new ParticleRandomBlock(\"Random Angular Speed\");\r\n    _CreateAndConnectInput(\"Min Angular Speed\", oldSystem.minAngularSpeed, randomAngularSpeedBlock.min);\r\n    _CreateAndConnectInput(\"Max Angular Speed\", oldSystem.maxAngularSpeed, randomAngularSpeedBlock.max);\r\n    randomAngularSpeedBlock.output.connectTo(createParticleBlock.angularSpeed);\r\n\r\n    // Angle (rotation)\r\n    const randomRotationBlock = new ParticleRandomBlock(\"Random Rotation\");\r\n    _CreateAndConnectInput(\"Min Rotation\", oldSystem.minInitialRotation, randomRotationBlock.min);\r\n    _CreateAndConnectInput(\"Max Rotation\", oldSystem.maxInitialRotation, randomRotationBlock.max);\r\n    randomRotationBlock.output.connectTo(createParticleBlock.angle);\r\n\r\n    // Lifetime\r\n    const randomLifetimeBlock = new ParticleRandomBlock(\"Random Lifetime\");\r\n    _CreateAndConnectInput(\"Min Lifetime\", oldSystem.minLifeTime, randomLifetimeBlock.min);\r\n    _CreateAndConnectInput(\"Max Lifetime\", oldSystem.maxLifeTime, randomLifetimeBlock.max);\r\n    randomLifetimeBlock.output.connectTo(createParticleBlock.lifeTime);\r\n\r\n    return createParticleBlock;\r\n}\r\n\r\nfunction _CreateEmitterShapeBlock(oldSystem: IParticleSystem): IShapeBlock {\r\n    const emitter = oldSystem.particleEmitterType;\r\n    if (!emitter) {\r\n        throw new Error(\"Particle system has no emitter type.\");\r\n    }\r\n\r\n    let shapeBlock: Nullable<IShapeBlock> = null;\r\n    switch (emitter.getClassName()) {\r\n        case \"BoxParticleEmitter\": {\r\n            const source = emitter as BoxParticleEmitter;\r\n            shapeBlock = new BoxShapeBlock(\"Box Shape\");\r\n\r\n            const target = shapeBlock as BoxShapeBlock;\r\n            _CreateAndConnectInput(\"Direction 1\", source.direction1, target.direction1);\r\n            _CreateAndConnectInput(\"Direction 2\", source.direction2, target.direction2);\r\n            _CreateAndConnectInput(\"Min Emit Box\", source.minEmitBox, target.minEmitBox);\r\n            _CreateAndConnectInput(\"Max Emit Box\", source.maxEmitBox, target.maxEmitBox);\r\n            break;\r\n        }\r\n        case \"ConeParticleEmitter\": {\r\n            const source = emitter as ConeParticleEmitter;\r\n            shapeBlock = new ConeShapeBlock(\"Cone Shape\");\r\n\r\n            const target = shapeBlock as ConeShapeBlock;\r\n            _CreateAndConnectInput(\"Radius\", source.radius, target.radius);\r\n            _CreateAndConnectInput(\"Angle\", source.angle, target.angle);\r\n            _CreateAndConnectInput(\"Radius Range\", source.radiusRange, target.radiusRange);\r\n            _CreateAndConnectInput(\"Height Range\", source.heightRange, target.heightRange);\r\n            _CreateAndConnectInput(\"Emit From Spawn Point Only\", source.emitFromSpawnPointOnly ? 1 : 0, target.emitFromSpawnPointOnly, NodeParticleBlockConnectionPointTypes.Int);\r\n            _CreateAndConnectInput(\"Direction Randomizer\", source.directionRandomizer, target.directionRandomizer);\r\n            break;\r\n        }\r\n        case \"CustomParticleEmitter\": {\r\n            // Custom emitter is not supported in nodes yet\r\n            throw new Error(\"CustomParticleEmitter is not supported in Node Particle System.\");\r\n        }\r\n        case \"CylinderParticleEmitter\": {\r\n            const source = emitter as CylinderParticleEmitter;\r\n            shapeBlock = new CylinderShapeBlock(\"Cylinder Shape\");\r\n\r\n            const target = shapeBlock as CylinderShapeBlock;\r\n            _CreateAndConnectInput(\"Height\", source.height, target.height);\r\n            _CreateAndConnectInput(\"Radius\", source.radius, target.radius);\r\n            _CreateAndConnectInput(\"Radius Range\", source.radiusRange, target.radiusRange);\r\n            _CreateAndConnectInput(\"Direction Randomizer\", source.directionRandomizer, target.directionRandomizer);\r\n            break;\r\n        }\r\n        case \"HemisphericParticleEmitter\": {\r\n            // Hemispheric emitter is not supported in nodes yet\r\n            throw new Error(\"HemisphericParticleEmitter is not supported in Node Particle System.\");\r\n        }\r\n        case \"MeshParticleEmitter\": {\r\n            const source = emitter as MeshParticleEmitter;\r\n            shapeBlock = new MeshShapeBlock(\"Mesh Shape\");\r\n\r\n            const target = shapeBlock as MeshShapeBlock;\r\n            _CreateAndConnectInput(\"Direction 1\", source.direction1, target.direction1);\r\n            _CreateAndConnectInput(\"Direction 2\", source.direction2, target.direction2);\r\n\r\n            target.mesh = source.mesh as Mesh;\r\n            break;\r\n        }\r\n        case \"PointParticleEmitter\": {\r\n            const source = emitter as PointParticleEmitter;\r\n            shapeBlock = new PointShapeBlock(\"Point Shape\");\r\n\r\n            const target = shapeBlock as PointShapeBlock;\r\n            _CreateAndConnectInput(\"Direction 1\", source.direction1, target.direction1);\r\n            _CreateAndConnectInput(\"Direction 2\", source.direction2, target.direction2);\r\n            break;\r\n        }\r\n        case \"SphereParticleEmitter\": {\r\n            const source = emitter as SphereParticleEmitter;\r\n            shapeBlock = new SphereShapeBlock(\"Sphere Shape\");\r\n\r\n            const target = shapeBlock as SphereShapeBlock;\r\n            _CreateAndConnectInput(\"Radius\", source.radius, target.radius);\r\n            _CreateAndConnectInput(\"Radius Range\", source.radiusRange, target.radiusRange);\r\n            _CreateAndConnectInput(\"Direction Randomizer\", source.directionRandomizer, target.directionRandomizer);\r\n            break;\r\n        }\r\n    }\r\n\r\n    if (!shapeBlock) {\r\n        throw new Error(`Unsupported particle emitter type: ${emitter.getClassName()}`);\r\n    }\r\n\r\n    return shapeBlock;\r\n}\r\n\r\nfunction _CreateUpdateSystem(inputParticle: NodeParticleConnectionPoint, oldSystem: IParticleSystem): NodeParticleConnectionPoint {\r\n    let outputUpdate: NodeParticleConnectionPoint = inputParticle;\r\n\r\n    outputUpdate = _CreatePositionUpdate(inputParticle);\r\n\r\n    if (oldSystem.gravity.equalsToFloats(0, 0, 0) === false) {\r\n        outputUpdate = _CreateGravityUpdate(outputUpdate, oldSystem.gravity);\r\n    }\r\n\r\n    return outputUpdate;\r\n}\r\n\r\nfunction _CreatePositionUpdate(inputParticle: NodeParticleConnectionPoint): NodeParticleConnectionPoint {\r\n    // Calculate the new position\r\n    const addPositionBlock = new ParticleMathBlock(\"Add Position\");\r\n    addPositionBlock.operation = ParticleMathBlockOperations.Add;\r\n    _CreateAndConnectContextualSource(\"Position\", NodeParticleContextualSources.Position, addPositionBlock.left);\r\n    _CreateAndConnectContextualSource(\"Scaled Direction\", NodeParticleContextualSources.ScaledDirection, addPositionBlock.right);\r\n\r\n    // Update the particle position\r\n    const updatePosition = new UpdatePositionBlock(\"Position Update\");\r\n    inputParticle.connectTo(updatePosition.particle);\r\n    addPositionBlock.output.connectTo(updatePosition.position);\r\n\r\n    return updatePosition.output;\r\n}\r\n\r\nfunction _CreateGravityUpdate(inputParticle: NodeParticleConnectionPoint, gravity: Vector3): NodeParticleConnectionPoint {\r\n    // Create the gravity step\r\n    const multiplyOutput = _CreateDeltaModifiedInput(\"Gravity\", gravity);\r\n\r\n    // Add it to the direction\r\n    const addDirectionBlock = new ParticleMathBlock(\"Add Gravity to Direction\");\r\n    addDirectionBlock.operation = ParticleMathBlockOperations.Add;\r\n    _CreateAndConnectContextualSource(\"Direction\", NodeParticleContextualSources.Direction, addDirectionBlock.left);\r\n    multiplyOutput.connectTo(addDirectionBlock.right);\r\n\r\n    // Update the particle direction\r\n    const updateDirection = new UpdateDirectionBlock(\"Direction Update with Gravity\");\r\n    inputParticle.connectTo(updateDirection.particle);\r\n    addDirectionBlock.output.connectTo(updateDirection.direction);\r\n\r\n    return updateDirection.output;\r\n}\r\n\r\nfunction _CreateColorUpdateBlock(oldSystem: IParticleSystem, createParticleBlock: CreateParticleBlock): UpdateColorBlock {\r\n    if (!oldSystem) {\r\n        throw new Error(\"Invalid particle system\");\r\n    }\r\n\r\n    // Calculate the color\r\n    const colorGradients = oldSystem.getColorGradients();\r\n    let colorBlock: Nullable<ParticleGradientBlock | ParticleMathBlock> = null;\r\n    if (colorGradients && colorGradients.length > 0) {\r\n        colorBlock = _CreateGradientColorUpdate(oldSystem, colorGradients, createParticleBlock);\r\n    } else {\r\n        colorBlock = _CreateBasicColorUpdate();\r\n    }\r\n\r\n    // Clamp alpha >= 0\r\n    const clampedColor = _ClampUpdateColorAlpha(colorBlock);\r\n\r\n    // Create the color update block\r\n    const colorUpdateBlock = new UpdateColorBlock(\"Color update\");\r\n    clampedColor.colorOut.connectTo(colorUpdateBlock.color);\r\n\r\n    return colorUpdateBlock;\r\n}\r\n\r\nfunction _CreateGradientColorUpdate(oldSystem: IParticleSystem, gradient: Array<ColorGradient>, createParticleBlock: CreateParticleBlock): ParticleGradientBlock {\r\n    const colorGradientBlock = new ParticleGradientBlock(\"Color Gradient\");\r\n    _CreateAndConnectContextualSource(\"gradient\", NodeParticleContextualSources.Age, colorGradientBlock.gradient);\r\n\r\n    let tempColor: Nullable<ParticleInputBlock | ParticleRandomBlock> = null;\r\n    let colorStart: Nullable<ParticleInputBlock | ParticleRandomBlock> = null;\r\n    let colorEnd: Nullable<ParticleInputBlock | ParticleRandomBlock> = null;\r\n    for (let i = 0; i < gradient.length; i++) {\r\n        const gradientStep = gradient[i];\r\n        const gradientValueBlock = new ParticleGradientValueBlock(\"Color Gradient Value \" + i);\r\n        gradientValueBlock.reference = gradientStep.gradient;\r\n\r\n        if (gradientStep.color2) {\r\n            // Create a random between color1 and color2\r\n            const randomColorBlock = new ParticleRandomBlock(\"Random Color for Gradient \" + i);\r\n            randomColorBlock.lockMode = ParticleRandomBlockLocks.PerSystem;\r\n            _CreateAndConnectInput(\"Color 1\", gradientStep.color1, randomColorBlock.min);\r\n            _CreateAndConnectInput(\"Color 2\", gradientStep.color2, randomColorBlock.max);\r\n            randomColorBlock.output.connectTo(gradientValueBlock.value);\r\n            tempColor = randomColorBlock;\r\n        } else {\r\n            // Single color\r\n            const input = new ParticleInputBlock(\"Color \" + i);\r\n            input.value = gradientStep.color1;\r\n            input.output.connectTo(gradientValueBlock.value);\r\n            tempColor = input;\r\n        }\r\n\r\n        if (gradientStep.gradient === 0) {\r\n            colorStart = tempColor;\r\n        } else if (gradientStep.gradient === 1) {\r\n            colorEnd = tempColor;\r\n        }\r\n\r\n        gradientValueBlock.output.connectTo(colorGradientBlock.inputs[i + 1]);\r\n    }\r\n\r\n    _UpdateCreateParticleColor(oldSystem, colorStart, colorEnd, createParticleBlock);\r\n\r\n    return colorGradientBlock;\r\n}\r\n\r\nfunction _CreateBasicColorUpdate(): ParticleMathBlock {\r\n    const addColorBlock = new ParticleMathBlock(\"Add Color\");\r\n    addColorBlock.operation = ParticleMathBlockOperations.Add;\r\n    _CreateAndConnectContextualSource(\"Color\", NodeParticleContextualSources.Color, addColorBlock.left);\r\n    _CreateAndConnectContextualSource(\"Scaled Color Step\", NodeParticleContextualSources.ScaledColorStep, addColorBlock.right);\r\n\r\n    return addColorBlock;\r\n}\r\n\r\nfunction _UpdateCreateParticleColor(\r\n    oldSystem: IParticleSystem,\r\n    colorStart: Nullable<ParticleInputBlock | ParticleRandomBlock>,\r\n    colorEnd: Nullable<ParticleInputBlock | ParticleRandomBlock>,\r\n    createParticleBlock: CreateParticleBlock\r\n): void {\r\n    if (colorStart === null) {\r\n        colorStart = new ParticleInputBlock(\"Color Start\");\r\n        colorStart.value = oldSystem.color1;\r\n    }\r\n\r\n    if (colorEnd === null) {\r\n        colorEnd = new ParticleInputBlock(\"Color End\");\r\n        colorEnd.value = oldSystem.color2;\r\n    }\r\n\r\n    const randomColorBlock = new ParticleRandomBlock(\"Random color\");\r\n    randomColorBlock.lockMode = ParticleRandomBlockLocks.PerSystem;\r\n    colorStart.output.connectTo(randomColorBlock.min);\r\n    colorEnd.output.connectTo(randomColorBlock.max);\r\n    randomColorBlock.output.connectTo(createParticleBlock.color);\r\n}\r\n\r\nfunction _ClampUpdateColorAlpha(colorBlock: ParticleMathBlock | ParticleGradientBlock): ParticleConverterBlock {\r\n    // Decompose color to clamp alpha\r\n    const decomposeColorBlock = new ParticleConverterBlock(\"Decompose Color\");\r\n    colorBlock.outputs[0].connectTo(decomposeColorBlock.colorIn);\r\n\r\n    // Clamp alpha to be >= 0\r\n    const maxAlphaBlock = new ParticleMathBlock(\"Alpha >= 0\");\r\n    maxAlphaBlock.operation = ParticleMathBlockOperations.Max;\r\n    decomposeColorBlock.wOut.connectTo(maxAlphaBlock.left);\r\n    _CreateAndConnectInput(\"Zero\", 0, maxAlphaBlock.right);\r\n\r\n    // Recompose color\r\n    const composeColorBlock = new ParticleConverterBlock(\"Compose Color\");\r\n    decomposeColorBlock.xyzOut.connectTo(composeColorBlock.xyzIn);\r\n    maxAlphaBlock.output.connectTo(composeColorBlock.wIn);\r\n\r\n    return composeColorBlock;\r\n}\r\n\r\nfunction _CreateDeltaModifiedInput(name: string, value: Vector3): NodeParticleConnectionPoint {\r\n    const multiplyBlock = new ParticleMathBlock(\"Multiply by Delta\");\r\n    multiplyBlock.operation = ParticleMathBlockOperations.Multiply;\r\n    _CreateAndConnectInput(name, value, multiplyBlock.left);\r\n    _CreateAndConnectSystemSource(\"Delta\", NodeParticleSystemSources.Delta, multiplyBlock.right);\r\n\r\n    return multiplyBlock.output;\r\n}\r\n\r\nfunction _CreateAndConnectInput(\r\n    inputBlockName: string,\r\n    value: number | Vector2 | Vector3 | Color4,\r\n    targetToConnectTo: NodeParticleConnectionPoint,\r\n    inputType?: NodeParticleBlockConnectionPointTypes\r\n): void {\r\n    const input = new ParticleInputBlock(inputBlockName, inputType);\r\n    input.value = value;\r\n    input.output.connectTo(targetToConnectTo);\r\n}\r\n\r\nfunction _CreateAndConnectContextualSource(contextualBlockName: string, contextSource: NodeParticleContextualSources, targetToConnectTo: NodeParticleConnectionPoint): void {\r\n    const input = new ParticleInputBlock(contextualBlockName);\r\n    input.contextualValue = contextSource;\r\n    input.output.connectTo(targetToConnectTo);\r\n}\r\n\r\nfunction _CreateAndConnectSystemSource(systemBlockName: string, systemSource: NodeParticleSystemSources, targetToConnectTo: NodeParticleConnectionPoint): void {\r\n    const input = new ParticleInputBlock(systemBlockName);\r\n    input.systemSource = systemSource;\r\n    input.output.connectTo(targetToConnectTo);\r\n}\r\n"]}